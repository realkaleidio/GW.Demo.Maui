<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="GW.Demo.Maui.Views.Screens.PostsView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:GW.Demo.Maui.ViewModels"
    xmlns:posts="clr-namespace:GW.Demo.Maui.Posts">

    <ContentView.Resources><vm:PostsViewModel x:Key="VM" /></ContentView.Resources>
    
    <Grid Padding="16" RowDefinitions="Auto,1,*">
        <Grid RowDefinitions="Auto" ColumnDefinitions="*,Auto">
            <Entry Grid.Column="0" Text="{Binding Query, Source={StaticResource VM}}" Placeholder="Suche…" FontSize="18" HeightRequest="44">
                <Entry.ReturnCommand><Binding Path="SearchCommand" Source="{StaticResource VM}" /></Entry.ReturnCommand>
            </Entry>

            <Button Grid.Column="1" Text="Suchen" Command="{Binding SearchCommand, Source={StaticResource VM}}" HeightRequest="44" Margin="12,0,0,0">
                <Button.Triggers>
                    <DataTrigger TargetType="Button" Binding="{Binding IsBusy, Source={StaticResource VM}}" Value="True">
                        <Setter Property="IsEnabled" Value="False" />
                        <Setter Property="Text" Value="Lädt…" />
                    </DataTrigger>
                </Button.Triggers>
            </Button>
        </Grid>

        <BoxView Grid.Row="1" HeightRequest="1" BackgroundColor="{DynamicResource SeparatorColor}" />

        <Grid Grid.Row="2">
            <RefreshView Command="{Binding RefreshCommand, Source={StaticResource VM}}" IsRefreshing="{Binding IsBusy, Source={StaticResource VM}}">
                <CollectionView ItemsSource="{Binding Items, Source={StaticResource VM}}" SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="0" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="posts:Post">
                            <Grid Padding="16" RowDefinitions="Auto,Auto,1">
                                <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="16" />
                                <Label Grid.Row="1" Text="{Binding Body}" FontSize="18" LineBreakMode="WordWrap" />
                                <BoxView Grid.Row="2" HeightRequest="1" BackgroundColor="{DynamicResource SeparatorColor}" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <Label Text="Keine Treffer" IsVisible="{Binding IsEmpty, Source={StaticResource VM}}" FontSize="18" Opacity="0.6" HorizontalOptions="Center" VerticalOptions="Center" />
        </Grid>
    </Grid>
</ContentView>
